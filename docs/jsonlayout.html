<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Configuring JSON Message Layout · Loki4j Logback</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Enabling the JSON layout"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Configuring JSON Message Layout · Loki4j Logback"/><meta property="og:type" content="website"/><meta property="og:url" content="https://loki4j.github.io/loki-logback-appender/"/><meta property="og:description" content="## Enabling the JSON layout"/><meta property="og:image" content="https://loki4j.github.io/loki-logback-appender/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://loki4j.github.io/loki-logback-appender/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/loki-logback-appender/img/logo-lite.svg"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-0Z4FEXM003"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'G-0Z4FEXM003');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/loki-logback-appender/js/scrollSpy.js"></script><link rel="stylesheet" href="/loki-logback-appender/css/main.css"/><script src="/loki-logback-appender/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/loki-logback-appender/"><img class="logo" src="/loki-logback-appender/img/logo-gray.svg" alt="Loki4j Logback"/><h2 class="headerTitleWithLogo">Loki4j Logback</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/loki-logback-appender/docs/configuration" target="_self">Docs</a></li><li class=""><a href="https://github.com/loki4j/loki-logback-appender/blob/main/CONTRIBUTING.md" target="_self">Contributing</a></li><li class=""><a href="/loki-logback-appender/help" target="_self">Help</a></li><li class=""><a href="https://github.com/loki4j/loki-logback-appender" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Configuring JSON Message Layout</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="enabling-the-json-layout"></a><a href="#enabling-the-json-layout" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enabling the JSON layout</h2>
<p>By default, the plain text layout (backed by Logback's <code>PatternLayout</code> class) is used.
But you can override this by specifying a <code>class</code> attribute for a <code>message</code> section:</p>
<pre><code class="hljs css language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"LOKI"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.github.loki4j.logback.Loki4jAppender"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">format</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">message</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.github.loki4j.logback.JsonLayout"</span> /&gt;</span>
        ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">format</span>&gt;</span>
    ...
<span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>
</code></pre>
<p>That's it! After running your application you should see your log messages are sent to Loki as JSON objects:</p>
<pre><code class="hljs css language-json">{<span class="hljs-attr">"timestamp_ms"</span>:<span class="hljs-number">1707947657247</span>,<span class="hljs-attr">"logger_name"</span>:<span class="hljs-string">"io.my.App"</span>,<span class="hljs-attr">"level"</span>:<span class="hljs-string">"INFO"</span>,<span class="hljs-attr">"thread_name"</span>:<span class="hljs-string">"main"</span>,<span class="hljs-attr">"message"</span>:<span class="hljs-string">"42"</span>}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="fine-tuning-the-standard-providers"></a><a href="#fine-tuning-the-standard-providers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fine-tuning the standard providers</h2>
<p>Loki4j comes with a predefined set of standard JSON providers, each of them can write zero, one, or more fields to the resulting JSON object.
All standard provides are enabled by default, but you can disable them using a corresponding setting:</p>
<pre><code class="hljs css language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">message</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.github.loki4j.logback.JsonLayout"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">timestamp</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">timestamp</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">message</span>&gt;</span>
</code></pre>
<p>This will remove a timestamp from the log record:</p>
<pre><code class="hljs css language-json">{<span class="hljs-attr">"logger_name"</span>:<span class="hljs-string">"io.my.App"</span>,<span class="hljs-attr">"level"</span>:<span class="hljs-string">"INFO"</span>,<span class="hljs-attr">"thread_name"</span>:<span class="hljs-string">"main"</span>,<span class="hljs-attr">"message"</span>:<span class="hljs-string">"42"</span>}
</code></pre>
<p>Most of the providers have a <code>fieldName</code> setting that allows you to customize a JSON field name they will write to:</p>
<pre><code class="hljs css language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">message</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.github.loki4j.logback.JsonLayout"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loggerName</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">fieldName</span>&gt;</span>class<span class="hljs-tag">&lt;/<span class="hljs-name">fieldName</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">loggerName</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">message</span>&gt;</span>
</code></pre>
<p>Applying this configuration will give you:</p>
<pre><code class="hljs css language-json">{<span class="hljs-attr">"timestamp_ms"</span>:<span class="hljs-number">1707947657247</span>,<span class="hljs-attr">"class"</span>:<span class="hljs-string">"io.my.App"</span>,<span class="hljs-attr">"level"</span>:<span class="hljs-string">"INFO"</span>,<span class="hljs-attr">"thread_name"</span>:<span class="hljs-string">"main"</span>,<span class="hljs-attr">"message"</span>:<span class="hljs-string">"42"</span>}
</code></pre>
<p>Some providers have their own specific properties, for example you can configure MDC provider to include only specified keys into the log record:</p>
<pre><code class="hljs css language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">message</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.github.loki4j.logback.JsonLayout"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mdc</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>myKey1<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>myKey2<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mdc</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">message</span>&gt;</span>
</code></pre>
<p>Please check the <a href="configuration#json-message-layout">reference</a> for a complete list of standard providers and their settings.</p>
<h2><a class="anchor" aria-hidden="true" id="custom-json-providers"></a><a href="#custom-json-providers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom JSON providers</h2>
<p>If standard providers don't cover all your needs, you may consider to create your own provider.
All providers must implement interface <code>com.github.loki4j.logback.json.JsonProvider</code>.
Here is the example implementation:</p>
<pre><code class="hljs css language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConstantProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractFieldJsonProvider</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConstantProvider</span><span class="hljs-params">()</span> </span>{
        setFieldName(<span class="hljs-string">"constant_name"</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeExactlyOneField</span><span class="hljs-params">(JsonEventWriter writer, ILoggingEvent event)</span> </span>{
        writer.writeStringField(getFieldName(), <span class="hljs-string">"constant_value"</span>);
    }
}
</code></pre>
<p>Then you need to enable this new provider in the configuration:</p>
<pre><code class="hljs css language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">message</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.github.loki4j.logback.JsonLayout"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">customProvider</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"io.my.ConstantProvider"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">message</span>&gt;</span>
</code></pre>
<p>After applying this configuration you will see the following:</p>
<pre><code class="hljs css language-json">{<span class="hljs-attr">"timestamp_ms"</span>:<span class="hljs-number">1707947657247</span>,<span class="hljs-attr">"logger_name"</span>:<span class="hljs-string">"io.my.App"</span>,<span class="hljs-attr">"level"</span>:<span class="hljs-string">"INFO"</span>,<span class="hljs-attr">"thread_name"</span>:<span class="hljs-string">"main"</span>,<span class="hljs-attr">"message"</span>:<span class="hljs-string">"42"</span>,<span class="hljs-attr">"constant_name"</span>:<span class="hljs-string">"constant_value"</span>}
</code></pre>
<p>You can add as many custom providers as you want:</p>
<pre><code class="hljs css language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">message</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.github.loki4j.logback.JsonLayout"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">customProvider</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"io.my.ConstantProvider1"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">customProvider</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"io.my.ConstantProvider2"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">customProvider</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"io.my.ConstantProvider3"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">message</span>&gt;</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#enabling-the-json-layout">Enabling the JSON layout</a></li><li><a href="#fine-tuning-the-standard-providers">Fine-tuning the standard providers</a></li><li><a href="#custom-json-providers">Custom JSON providers</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/loki-logback-appender/" class="nav-home"><img src="/loki-logback-appender/img/logo.svg" alt="Loki4j Logback" width="66" height="58"/></a><div><h5>Docs</h5><a href="/loki-logback-appender/docs/configuration">Reference</a></div><div><h5>Community</h5><a class="github-button" href="https://github.com/loki4j/loki-logback-appender" data-icon="octicon-star" data-count-href="/loki4j/loki-logback-appender/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Loki4j GitHub</a><div class="social"><a href="https://twitter.com/arnehaev" class="twitter-follow-button">Follow @arnehaev</a></div><a href="https://stackoverflow.com/questions/tagged/loki4j" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="https://docusaurus.io/">Powered by Docusaurus</a></div></section><section class="copyright">Copyright © 2024 Anton Nehaev</section></footer></div><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script></body></html>